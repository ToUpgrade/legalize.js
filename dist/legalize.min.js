/*! legalize 22-05-2015
    Copyright (C) 2014 eBay Software Foundation
    Licensed under the Apache License, Version 2.0. */

!function(a){"use strict";"function"==typeof define&&define.amd?define("Legalize",a):window.Legalize=a()}(function(a){"use strict";function b(a){return"function"==typeof a}Array.isArray||(Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)});var c={freeze:b(Object.freeze)?Object.freeze:function(a){return a},keys:b(Object.keys)?Object.keys:function(){var a=Object.prototype.hasOwnProperty,b=!{toString:null}.propertyIsEnumerable("toString"),c=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],d=c.length;return function(e){var f,g,h=[];for(f in e)a.call(e,f)&&h.push(f);if(b)for(g=0;d>g;g+=1)a.call(e,c[g])&&h.push(c[g]);return h}}(),create:b(Object.create)?Object.create:function(a){function b(){}return b.prototype=a,new b}};return function(b){function c(a){return function(b){return!a(b)}}function d(a){return Array.isArray(a)?"array":null===a?"null":typeof a}function e(b,c){if(d(b)===c)return b;switch(c){case"string":return String(b);case"number":return Number(b);case"boolean":return"true"===b?!0:"false"===b?!1:Boolean(Number(b));default:return a}}function f(a){return"function"===d(a)}function g(a){return"object"===d(a)}function h(a){return"number"===d(a)}function i(a){return"string"===d(a)}function j(a){return"array"===d(a)}function k(b){return null===b||b===a}function l(a){var b=Number(a);return b===b}function m(a){return parseInt(a)===Number(a)}function n(c){return j(c)||i(c)?c.length:g(c)?b.keys(c).length:a}function o(a){return k(a)||0===n(a)}function p(a,b){return a instanceof b}function q(a,c){var d;if(j(a))for(d=0;d<a.length;d+=1)a[d]=c(a[d],d);else{var e=b.keys(a);for(d=0;d<e.length;d+=1){var f=e[d];a[f]=c(a[f],f)}}}function r(a,b){q(a,function(a,c){return b(a,c),a})}function s(){for(var a={},b=0;b<arguments.length;b+=1){var c=arguments[b];r(c,function(b,c){if(j(a[c])){var d=function(b){a[c].push(b)};j(b)?b.forEach(d):d(b)}else g(a[c])&&g(b)?a[c]=s(a[c],b):a[c]=b})}return a}function t(a,b){return g(b)&&r(b,function(c,d){a[d]=b[d]}),a}function u(a,c){if(!j(a)&&!g(a))return a===c||a!==a&&c!==c;if(n(a)!==n(c))return!1;for(var d=s({x:b.keys(a)},{x:b.keys(c)}).x,e=0;e<d.length;e+=1){var f=d[e];if(!u(a[f],c[f]))return!1}return!0}function v(a){if(a._isSchema)return a;if(a._isSchemaBuilder&&f(a.compile))return a.compile();if(p(a,RegExp))return H.string().match(a).compile();if(j(a)){var b=H.alternatives;return b.apply(H,a).compile()}return g(a)?H.object().keys(a).compile():H.any().valid(a).compile()}function w(a,c){return function(){var d=Array.prototype.slice.call(arguments),e=b.create(this),g=this;return t(e,c),e.compile=function(b){var c=s(g.compile(!0),f(a)?a(d):a);if(!b){var e=function(a){return v(a)};q(c.includes,e),q(c.excludes,e),q(c.keys,e),q(c.alternatives,e)}return c._isSchema=!0,c},e}}function x(a){return w(function(b){var c={};return c[a]=b[0],c})}function y(a){return w(function(b){var c={};return c[a]=b,c})}function z(a){return w(function(b){return{checks:function(c){return a(c,b[0])}}})}function A(a){return z(function(b){return a.test(b)})}function B(a,b){return function(){var c=Array.prototype.slice.call(arguments);return b.apply(a,c)}}function C(a){return s(a,{minLength:z(function(a,b){return n(a)>=b}),maxLength:z(function(a,b){return n(a)<=b}),length:z(function(a,b){return n(a)===b})})}function D(){return{allowed:[],valid:[],invalid:[],checks:[],checksAfter:[],alias:{},keys:{},includes:[],excludes:[],alternatives:[],sanitizeBefore:[],sanitize:[],pattern:null,_isSchema:!0}}function E(b,c,h,k){function l(b,c,f){function k(a,c,d){return{type:a,expected:c,actual:d,sourcePath:f,sourceValue:b}}function m(a,b,c){q.push(g(a)?a:k(a,b,c))}function n(a,b,c,d){var e=k(b,c,d);return L(y)&&x===J&&h.warnOnInvalidOptionals?(m(e),s(a)):{error:e,value:a}}function s(a){return{value:a}}function v(a){j(a)?r(a,function(a){v(a)}):i(a)?v(k(a)):g(a)&&m(t(k(),a))}var w=d(b),x=c.presence||h.presence,y=c.defaultValue,z=c.type,A=0,B=0;if("undefined"===w)return x===J?s(y):x===I?n(a,"required_missing"):s();if(x===K)return n(a,"forbidden_encountered");var C=c.alternatives;if(!o(C)){for(A=0;A<C.length;A+=1){var D=C[A],E=l(b,D,f);if(!E.error)return E}return n(y,"no_alternative_matched")}r(c.sanitizeBefore,function(a){b=a(b)});var F=c.alias;if(L(F[b])&&(b=F[b]),L(z)&&w!==z){if(h.strict)return n(y,"mismatching_types",z,w);m("mismatching_types",z,w),b=e(b,z)}var G=c.allowed;for(A=0;A<G.length;A+=1)if(u(G[A],b))return s(b);var H=c.invalid;for(A=0;A<H.length;A+=1)if(u(H[A],b))return n(y,"invalid_value");var M=c.valid;if(!o(M)){for(A=0;A<M.length;A+=1)if(u(M[A],b))return s(b);return n(y,"not_a_valid_value")}var N=[];if(r(c.checks,function(a){var c;try{c=a(b)}catch(d){return console.log("Error while executing user-defined function"),console.log(d),!1}c!==!0&&(g(c)||(c=k("check_failed")),N.push(c))}),!o(N))return n(y,"checks_failed");if("object"===z){var O={},P=[];r(c.keys,function(a,c){var d=l(b[c],a,f+"/"+c);if(d.error){var e=a.presence||h.presence;e===J&&h.warnOnInvalidOptionals?m(d.error):P.push(d.error)}O[c]=d.value});var Q=p(c.pattern,RegExp)?c.pattern:null;if(r(b,function(d,e){if(!c.keys[e]){var f=k("unknown_key",a,e),g=!h.stripUnknown;Q&&Q.test(e)?g=!0:h.allowUnknown?h.warnUnknown&&m(f):P.push(f),g&&(b[e]=d)}}),!o(P))return n(O,P);b=O}else if("array"===z){var R=[],S=[],T=c.includes,U=c.excludes;if(o(T)?o(U)?R=b:r(b,function(a){var b,c=!0;for(B=0;B<U.length;B+=1)if(b=l(a,U[B],f+"/"+A),!b.error){c=!1;break}c?R.push(b.value):S.push(k("matched_excluded_type"))}):r(b,function(a){var b,c=!1;for(B=0;B<T.length;B+=1)if(b=l(a,T[B],f+"/"+A),!b.error){c=!0;break}c?R.push(b.value):S.push(b.error)}),!o(S))return n(R,S);b=R}return r(c.checksAfter,function(a){var c;try{c=a(b)}catch(d){return console.log("Error while executing user-defined function"),console.log(d),!1}c!==!0&&v(c)}),r(c.sanitize,function(a){b=a(b)}),s(b)}function m(a,b){return j(a.type)?r(a.type,function(a){m(a,b)}):b.push(a),b}if(k=f(k)?k:f(h)?h:null,h=g(h)?h:{},o(h))h=G;else{var n=E(h,F);if(n.error)throw new Error(n.error);h=n.value}c=v(c);var q=[],s=l(b,c,""),w=s.error?m(s.error,[]):null,x=s.value;return q=o(q)?null:q,f(k)?void setTimeout(function(){k(w,x,q)},0):{error:w,value:x,warnings:q}}var F,G,H={},I="required",J="optional",K="forbidden",L=c(k),M={_isSchemaBuilder:!0,compile:D,notEmpty:z(c(o)),allow:y("allowed"),valid:y("valid"),invalid:y("invalid"),alias:x("alias"),check:y("checksAfter"),satisfy:y("checks"),sanitize:y("sanitize"),sanitizeBefore:y("sanitizeBefore"),required:w({presence:I}),optional:w({presence:J}),forbidden:w({presence:K}),"default":x("defaultValue")},N=w({}),O=w({type:"boolean"}),P=w({type:"function"}),Q=w({type:"number"},{min:z(function(a,b){return a>=b}),max:z(function(a,b){return b>=a}),greater:z(function(a,b){return a>b}),lesser:z(function(a,b){return b>a}),integer:z(m)}),R=w({type:"string"},C({match:z(function(a,b){return new RegExp(b).test(a)}),insensitive:w({insensitive:!0}),lowercase:z(function(a){return a=String(a),a.toLowerCase()===a}),uppercase:z(function(a){return a=String(a),a.toUpperCase()===a}),alphanum:A(/^[0-9a-zA-Z]*$/),url:A(/^https?:\/\/(\w+:?\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?$/),element:z(function(a){return!!window.document.getElementById(a)}),digits:z(/^[0-9]*$/),numeric:z(l)})),S=w({type:"array"},C({unique:z(function(a){for(var b={},c=0;c<a.length;c+=1){var d=a[c];if(h(d)||i(d)){if(b[d])return!1;b[d]=!0}}return!0}),includes:y("includes"),excludes:y("excludes")})),T=w({type:"object"},C({keys:x("keys"),type:z(p),pattern:x("pattern")})),U=y("alternatives");return H=b.freeze({any:B(M,N),bool:B(M,O),"boolean":B(M,O),number:B(M,Q),string:B(M,R),object:B(M,T),array:B(M,S),func:B(M,P),alternatives:B(M,U),compile:v,validate:E,typeOf:d}),F=v({allowUnknown:H.bool()["default"](!1),stripUnknown:H.bool()["default"](!0),warnUnknown:H.bool()["default"](!0),strict:H.bool()["default"](!0),warnOnInvalidOptionals:H.bool()["default"](!0),presence:H.any().valid(J).valid(I).valid(K)["default"](J)}),G={allowUnknown:!1,stripUnknown:!0,warnUnknown:!0,strict:!0,warnOnInvalidOptionals:!0,presence:J},H}(c)});
//# sourceMappingURL=legalize.min.js.map